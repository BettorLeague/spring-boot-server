sudo: required

services:
  - docker
addons:
    apt:
        packages:
            - sshpass

language: java
jdk:
 - oraclejdk8


env:
  global:
  - secure: "FYBoZ8UZuuYAQh3+3H/I9+R+Rijp0uvuds0bI7kX0QnPceeKr927RI7PFptzi/ns+nVsT71VBp+gula7PtGXEG3ErtxHffXvM1zBztgDO8cZF4YU9isjYdds1TLMagjaE1ZLjy9sVQnPz6wmjwfJYkdYh9gRH/h/NdQFC6qT1LT3RyJSQUp+0uJNZunsI8UPWBr+teohTDdABgmTHXO48EvsdA+cZPsV9p3gANXOXE+UcKzV1dXfsqJ+Rdr4Kh8wxROjmDwPmTaiJgzD7UrBkH1GIB9dKcuCyxIoDVhe8iyxINHc/LiMxX9clorJItAvdvPqx5t46gDduFiqTAFM5z+qwOn7iJzqwakD1EpxLDSQo915KHiG1yoLxiL/meZMpgg0YUeQ/zZgskabZXeNE1jUhy3verwUiSX4L30TabRxNI8PaEcigmkUQKSedMe9RmLYpfXnESjTWXMEjtczrz/9IaJP7iy2IgQw2rMkTJ1cVUUqExJGe1+v4hLn+udMwZU9tiOIM3PnUdF9NXn0DBD2HbvaNPUyUIr2PxMqCqNW9Jlp87KO4TKlbCahBOo/rreCakqoKGs2w9l9rkat42nQn09uLG28hjKMlhouylSU0+tr/F41ncAjgztW/BjFqMT5kKw519wc1jKxHwvd1drZcrGqel33nHYwrU8eIEs=" # DOCKER_USER
  - secure: "nV9D7bWeIPCTThECPNdKuX2kNbM99Vkc21PzBrrbFU73m+QDhheYRq1dT7m10OZaNdTwTbF2JwMfgU1P6uU0GkxHnW68KQAanKbtK1KGyAgjBPKjTCeCr5qs5UnSQBAdYujpNGAM8K8xfhlRp5LBOPGAFSkOAEH7CEg48K396YwuIRl7s8QzDsRbV0YBrq6a6b7mQ7JA92q7AamMxzmRqIn1o+KZtcoUnJfQcULJmmTnO0wTEsjBnBt449lha+xf5Zod714AWxLoTaKtVfqQWGn0sAYOddVIlszkCf3A4CRoGfx6EygC8PltQKsiT/Nc4oribaj5HmtrzqG0BhPGQwR/7Q+dZtK2nNOvCUDvuVZ/ohRTabBckRSvnWc1LuDNUxRZTz0d0T8oxRe0ElHnTmLOp3RFClmIcRix3bSoS2sJ/4RbglA/ZZCuLhb/T7X/MungdyBL7cyRiMs3nnrbgao85OHMVMEV/o1aYEuBXiPmLXVyv8wdzbyF2klTryPSEUXV923KHdlkcaARUtRxmat87hkIWCHW7i0oqFQBiwrqT2aCMKFhNgV2SC2DbxcrqwbpvMU6vuvCMWELbc2N+W38uDSBZmlLNTpF5O0YXDHzHRzi13agNsRz8MN29fipJmI61QE65SL789URgWKuH0zSDB/2fYjTnhjwglfToc4=" # DOCKER_PASS
  - secure: "Sw1NEEm+eWRdJGbBlUbhpSOGSfNu1gYXPZVNYcKv/fZXaGZKv9PR+IOy/vxRqaGiC2S4gGuxiccuCPbj2OBWrLzB+zlOW2XYu2ey6346BPrNFqNQdZThcBqtVOx+lxGkEbUERhiO4JsIvKgMwhKmBh+yR9+UtySmfXvxgfsA4suLKwZ3574vDaN6eFzB2ElO799qNKr4RBQHakXLc3nhSIMlJrnMhah2GZYShN8PMD0OXqHcYrdvK7TRpnc0LHOR7uNEiSiQPm+jVgQ8W2JQIumOiMTCTcjgWGPRuurWbcME3NsbqmM2hPppjDueQv36d8UBxp7E2sNeuCeblYsXYjFfL/mIrIubac3A4JGzuVIYjDpdJLV2pxI6HSYxXGTwrqVClu/Vksf5v9d1Kx9wiNjg4jwB67wu/KFXCDVWMOft7EIRqeqMu+gWt8nufB40kubWmA9IWztzCC0Pea3+KkCzyM9iNQwiqZgWTCEI2LHGsb5IRPk4N/OHQKXYSQllu4eZeRhDCRruLxGIOCq46ubj8bxlHAv1lHY35tWErE13Mi0d33IFP5yvCEIUUKvEISYP4i/sWPjvkbyOvxiW85tXOrrNShzjPlKOVJjUs1aJjOLVoDZ61N5Z2rSiftvkoP24IosHVqO49d59ne1EQ4edltfOubABLGDpSgFX3dU=" # DOCKER_EMAIL
  - secure: "D/wggpPpvCqJtz3g9vTAHU4xPCk9b6NJ4+CEWCJAlpWZRJzgor/iq48+sNXgzufBVLC2DICyvTkHex10EtFbGCPMbdskLFlCGs/nlnN5JzWDvQUrUbqgzr2b+HSQgjnnx9yc/vuPmfb7g7o1U19tGbF9XhCVB2AtU+q31K/iHpIDfNtMtxly8pl/XAGePI1FLB6E7kknzHQWErlMiAJktRM7xvALoRQRE2WBihg3qbuY7LwPlabpBsPqkZwo+v+Zaei1JAuiYR/0myZeFpUk7Ls9PfCLx+i+hzDxsRIGEgt9YROe5TQSNXS1SAcd4M5eQnjMZwXIKTBoAojUwEcD8JV8a90LK952c+DcUqorpo2RRaPaFzxLSggb3JS53b+UEMKGnqc22iZrhm7LRmVAAfbJovvXxGUYDPM8aHdLOXdq+ogsq/aMyi4GkPMiRrsEcSdljtqs4bF1X6RZGOcLNxHOE66QrlsqVFKzOFZnChJYCPPTZD9n7clF3gHuLdSfVu773Hd1NNAfXCk1sETep0e8/weqL/z0rXljXXfB4Jpk/36AFPpNB5mmfKqxRz/8VIv8hqM+GWfymOz2M78vAGXiGe0I3U/ItbdTzEGicMW+1hQ0dnu5OvjMKzqT26kaJSO18v6yUsXKZa9hdJaFhggJaxoHj7RTJvO4W4Yk7dw=" # DEPLOY_HOST
  - secure: "HT0kpSaSwidLltkdElLvJQBf32N/nPOkz8niGbZAOEnkkerKKe8tP3fNWSZ8sgU0DczGIIJhoB2RQ47YQBxrOsn1xmdcqM5i5igl4jaAlEMWy0RWzS3E+zrLE0dTN2Dy138iOvf1+AUAmYTYHptQaw3skFAvSjAX+5lRf9DdCm8lIhg0X2X5JZiiPr+4HceoashAvaVh+XVllZ+ETjyO9XGr0mMMBhArDysEUmIltvCZtAI9S3I8pUEduhg38GjyP5iNhc3pd5JSRosA8f7EPHOGCDccvALhwtBGn0TpReIuUYWTrshWNMGtUIESpguUbuMEA5S9kHOEsrSUVxb2An3txVAQy3Bn1VOoiQ3fROGSaPBIHobLuEO+gMc8KLcPtTjwDEKXsq/dCHxrQINjp8Q06QpUPoblfghTuLJvf/nYoeh5fzF8DbqLfLeurxMI0N9uoDbXsI8gbMHDAw102xcwwGQLoImTA+nsOht5lwAxmZIPB3+lkuxPpKByHeeBR3ZRM7aHyMoEUrellk60IAN35oh04IB9k5Es3gx98IDPDYFmVpgVEyqHV2oGm5gXpqn7zMYheh7mwY7sX4WkboRZRuzM7e1MZNgFZZO8PDxL2se7fcWGi6U3ettS7V8wlpRZDixNbBVeYIUoStNQDQTKCa17TwhVeCzlcUz8D0s=" # DEPLOY_USER
  - secure: "A9O4ZLYSAejnTNmWB8YFRt5cQ903WQpJL38MgKD1gm9WKYBx9J+U+dASjy9tkBX4VJ0dO9yna7/DLj08qXzO3+omB2st+JR8NvbxROEZ5aWVNX6cVt2j/JsGc/Tg5Ia3IaJvxM8pzxUVU/iXpplr2jsPuHFHvH2pxeBSyoPptwTwUYy/LqObtbRepL7f3cDSNJxH+2N4YYRGJZql+Y8umYWfwbcwIPmiASgO2UMqEOT89Q14HQk8RiCDHW1luX7KzUTAT0TrXFtEETGxSRqFWm2Xwm/WjsbRTByGlOBbmcGL8mEzo/DPj7B2AP018jAhNuayujZe2yQ8H0qFJew44uuOdXD/ZpLFdHG5mVgs5o37nF9gxxkslxfj9FGEZe0MEYXxWDGfxuKoXV/vVc/r3W+BjUSV7Ue9Iz0V2W7rqEJKidGbn5aH+bF0OiUfyZGJKKNwI9TAMv90cDKvWimNFmS82CpZ0Uvt1aufA2fcPRhB3DFc+Yc0U5Vf4v7mVQgQ/r+JzOU1v+w3SPfU/mL5p9NuQxrvXbP1t7PlA44YmDVJGlBgOpj3yZ5i61Vz/uwPsMiyvYZfUCIRs95T481KRvyBX8lLw0BR1UwePXugluf59BJeS4aCoCXlLOlywtDvEGlEhtdFZnRjHsMX+lGpK2CjVUEgoPQfpfHcsZVHhag=" # DEPLOY_PASS
  - secure: "QexrSTcnGBA2BpXSJlgwTaVqnoI1tQBqnQvKtpqdHp0riUT5Jib7/OVbvm6DII+5cSl3PJcT6EYGthFhpn+NLqCmM21lW75agJGHNidI6hbgA7oWo4vaDj0vXxp27hnI7Zh1/QxgqVzXQqd/UwnTZY7Rb1Q1hpdFSdLPlo50quJpqR2bZBqwu4FEWqXcQ7Zr0+ZM/wSWxT4l4unlJSBa4Dtqt72SbwbDJ/oC0INksO1PcL1fF0wQRYXqWlGlDPXfcmpExQONnX0nW3koJiYIAOsS28Bt75KneaAtFpMz6GFPmXXb8YNGa5ZoWtKk3sqzC090JXTllsjZKjH+tzxXykoVvHe+F0YxWyWOqSyauC1Ng0mzw7Rlc269zOFOYFeWsI+YDu2+UYGr0LT6R83NNpxCOVEMmtQMDGE4rzGsuCUyKfx6XW1tg6doOmgS//clv+XO7xymHReDa0wpZ0/0l4uxU7fb8xywIdaLicm8getipuz19NL17GPwE+Z/oa9XR+biCU3mWU8abFK71z8Jqur1oh+mf5ns9vsMVbhW6KGxcOaxJSfafRSJl9sYUcKbjsMdPgJkhvqTOAQmwIiwBMyKImADX+1nOL19HpMD7d3ScF+oWbVKoz02LMeArZ5Yp+9biTdtW/jEY7O65o1MPUIXnjY9mXoKOCbw3rkz8bg=" # DEPLOY_PATH
  - COMMIT=${TRAVIS_COMMIT::7}

script:
  - ./mvnw clean install -B

after_success:
  - docker login -u $DOCKER_USER -p $DOCKER_PASS
  - export TAG=`if [ "$TRAVIS_BRANCH" == "master" ]; then echo "latest"; else echo $TRAVIS_BRANCH ; fi`
  - export IMAGE_NAME=bettor-league-api
  - docker build -t $IMAGE_NAME:$COMMIT .
  - docker tag $IMAGE_NAME:$COMMIT nadjim/$IMAGE_NAME:$TAG
  - docker push nadjim/$IMAGE_NAME
  - sshpass -p $DEPLOY_PASS ssh -o stricthostkeychecking=no $DEPLOY_USER@$DEPLOY_HOST bash $DEPLOY_PATH/deploy.sh

deploy:
  - provider: heroku
    api-key:
      secure: "UJEmkN+K5WFi5IS6lL2KgcA6qkZ3erlvTMz1hqw6h4P9g3IiUPr7wDkqHpIs/z+nxEMTxIfhZhNT6Qdkp0F99RFdXkCZIDTVF4xFrKADJoXcsY5Rr9izIML84jqJoLZOXguKg1kcGgRupvcgHwgAR/KZb/oS8P3U/8abMCgPAvW5a2yMtF11C3MHAgGfRnJS8rJFwqr8gmOyCg02nEEJo5EMZYeg8RY9GqOx3KAzTehq8snMR4I7MFoWqeaEIC1lt/EFHqypdPJtH1Rknb9OAtplx6R/X7OieQWliPTxuzWq/CT/KOqgyOXXDMrfGKJSVUO9jg/BgLV5u4ihWVe5KhvWJKeyGs/HNNBCzuAW+3Yl/IqYH6VUd7NkENYy31o80i7JUbF7Meatj2ZvX/PJra650mn33c17FyLJb1XxPhWYimYw3/UMatLpvLSdGvUsZPCXU8fXCf136PE8/zMwECMRqUPR2UoLNFE+rS91MHSPMBMBrHL1Ym4y+ii3//sm6rZJQADEJlqezNU4guevVUBPNtwBDxKJxd7jr1Uy7jxGFaadJy7/aA8VAzn85sckJjruNTQJ1ewWM7IjaIJjVVgNcSEzSysaFOgvTEmP2DKJ6CcH1+kOwRr5Zlo+zg64ncTNLwXxcvjEU+1lEc2MpZPchP6CP9XjEWrnHKPuvmY="
    app: bettor-league
